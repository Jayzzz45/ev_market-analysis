<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span><span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">calmap</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev2w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_2_Wheeler_Sales.csv"</span><span class="p">)</span>
<span class="n">ev3w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_3_Wheeler_Sales.csv"</span><span class="p">)</span>
<span class="n">ev4w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_4_Wheeler_Sales.csv"</span><span class="p">)</span>
<span class="n">evbus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_Bus_Sales.csv"</span><span class="p">)</span>
<span class="n">electrical_consumption</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electrical_Consumptiondataa.csv"</span><span class="p">)</span>
<span class="n">charging_stations</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Statewise_EV_Charging_Stations.csv"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev2w</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">ev2w</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev3w</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">ev3w</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev4w</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">ev4w</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">evbus</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">evbus</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">electrical_consumption</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">electrical_consumption</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">charging_stations</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">charging_stations</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#styles</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'seaborn-v0_8-dark'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s2">"husl"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Stacked Bar Plot</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">electrical_consumption</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">]))</span>  
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.6</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">electrical_consumption</span><span class="p">[</span><span class="s1">'Electricity Consumed in EV Charging Stations (excl. Heavy Duty) (in MU) from april 2024 to august'</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Excl. Heavy Duty'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'teal'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">electrical_consumption</span><span class="p">[</span><span class="s1">'Electricity Consumed in Heavy Duty PCS only (in MU) from april 2024 to august'</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">electrical_consumption</span><span class="p">[</span><span class="s1">'Electricity Consumed in EV Charging Stations (excl. Heavy Duty) (in MU) from april 2024 to august'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Heavy Duty'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Electricity Consumption by Type in Each Region'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Region'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Electricity Consumed (in MU)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">electrical_consumption</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'right'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">quarters</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Q1'</span><span class="p">,</span> <span class="s1">'Q2'</span><span class="p">,</span> <span class="s1">'Q3'</span><span class="p">,</span> <span class="s1">'Q4'</span><span class="p">]</span>
<span class="n">ev2w</span><span class="p">[</span><span class="s1">'Q1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev2w</span><span class="p">[[</span><span class="s1">'Apr'</span><span class="p">,</span> <span class="s1">'May'</span><span class="p">,</span> <span class="s1">'Jun'</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ev2w</span><span class="p">[</span><span class="s1">'Q2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev2w</span><span class="p">[[</span><span class="s1">'Jul'</span><span class="p">,</span> <span class="s1">'Aug'</span><span class="p">,</span> <span class="s1">'Sep'</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ev2w</span><span class="p">[</span><span class="s1">'Q3'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev2w</span><span class="p">[[</span><span class="s1">'Oct'</span><span class="p">,</span> <span class="s1">'Nov'</span><span class="p">,</span> <span class="s1">'Dec'</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ev2w</span><span class="p">[</span><span class="s1">'Q4'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ev2w</span><span class="p">[[</span><span class="s1">'Jan'</span><span class="p">,</span> <span class="s1">'Feb'</span><span class="p">,</span> <span class="s1">'Mar'</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot seasonal trends</span>
<span class="n">ev2w</span><span class="p">[</span><span class="n">quarters</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">'line'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Seasonal Trends in 2-Wheeler Sales'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Quarter'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Sales'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev2w</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Yearly Sales Breakdown for 2-Wheelers'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Sales'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Month'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Combine yearly total sales for all vehicle types</span>
<span class="n">combined_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">],</span>
    <span class="s1">'2-Wheelers'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'3-Wheelers'</span><span class="p">:</span> <span class="n">ev3w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'4-Wheelers'</span><span class="p">:</span> <span class="n">ev4w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'Buses'</span><span class="p">:</span> <span class="n">evbus</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Plot stacked area chart</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">combined_sales</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">],</span> <span class="n">combined_sales</span><span class="p">[</span><span class="s1">'2-Wheelers'</span><span class="p">],</span> <span class="n">combined_sales</span><span class="p">[</span><span class="s1">'3-Wheelers'</span><span class="p">],</span> <span class="n">combined_sales</span><span class="p">[</span><span class="s1">'4-Wheelers'</span><span class="p">],</span> <span class="n">combined_sales</span><span class="p">[</span><span class="s1">'Buses'</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'2-Wheelers'</span><span class="p">,</span> <span class="s1">'3-Wheelers'</span><span class="p">,</span> <span class="s1">'4-Wheelers'</span><span class="p">,</span> <span class="s1">'Buses'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sales Contribution by Vehicle Type Over the Years'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Sales'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">combined_sales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'coolwarm'</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">'.2f'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Correlation Between Vehicle Types'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Preparing  the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Region'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'Andaman &amp; Nicobar'</span><span class="p">,</span> <span class="s1">'Andhra Pradesh'</span><span class="p">,</span> <span class="s1">'Arunachal Pradesh'</span><span class="p">,</span> <span class="s1">'Assam'</span><span class="p">,</span> <span class="s1">'Bihar'</span><span class="p">,</span>
        <span class="s1">'Chandigarh'</span><span class="p">,</span> <span class="s1">'Chhattisgarh'</span><span class="p">,</span> <span class="s1">'D&amp;D and DNH'</span><span class="p">,</span> <span class="s1">'Delhi'</span><span class="p">,</span> <span class="s1">'Goa'</span><span class="p">,</span> <span class="s1">'Gujarat'</span><span class="p">,</span>
        <span class="s1">'Haryana'</span><span class="p">,</span> <span class="s1">'Himachal Pradesh'</span><span class="p">,</span> <span class="s1">'Jammu &amp; Kashmir'</span><span class="p">,</span> <span class="s1">'Jharkhand'</span><span class="p">,</span> <span class="s1">'Karnataka'</span><span class="p">,</span>
        <span class="s1">'Kerala'</span><span class="p">,</span> <span class="s1">'Lakshadweep'</span><span class="p">,</span> <span class="s1">'Madhya Pradesh'</span><span class="p">,</span> <span class="s1">'Maharashtra'</span><span class="p">,</span> <span class="s1">'Manipur'</span><span class="p">,</span>
        <span class="s1">'Meghalaya'</span><span class="p">,</span> <span class="s1">'Nagaland'</span><span class="p">,</span> <span class="s1">'Odisha'</span><span class="p">,</span> <span class="s1">'Pondicherry'</span><span class="p">,</span> <span class="s1">'Punjab'</span><span class="p">,</span> <span class="s1">'Rajasthan'</span><span class="p">,</span>
        <span class="s1">'Sikkim'</span><span class="p">,</span> <span class="s1">'Tamil Nadu'</span><span class="p">,</span> <span class="s1">'Telangana'</span><span class="p">,</span> <span class="s1">'Tripura'</span><span class="p">,</span> <span class="s1">'Uttar Pradesh'</span><span class="p">,</span> <span class="s1">'Uttarakhand'</span><span class="p">,</span>
        <span class="s1">'West Bengal'</span>
    <span class="p">],</span>
    <span class="s1">'EV Charging Stations'</span><span class="p">:</span> <span class="p">[</span>
        <span class="mi">3</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1886</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">1041</span><span class="p">,</span> <span class="mi">852</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> 
        <span class="mi">341</span><span class="p">,</span> <span class="mi">3079</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">643</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">582</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">318</span>
    <span class="p">]</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Bar plot/</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">'EV Charging Stations'</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'skyblue'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'EV Charging Stations by Region (2024)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Region'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Number of EV Charging Stations'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Sort and select top 10</span>
<span class="n">top_10</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'EV Charging Stations'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Horizontal bar plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">top_10</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">],</span> <span class="n">top_10</span><span class="p">[</span><span class="s1">'EV Charging Stations'</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Top 10 Regions with the Most EV Charging Stations (2024)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of EV Charging Stations'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Region'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>  <span class="c1"># Reverse the order</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Pie chart</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'EV Charging Stations'</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">],</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">'</span><span class="si">%1.1f%%</span><span class="s1">'</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">140</span><span class="p">,</span> <span class="n">textprops</span><span class="o">=</span><span class="p">{</span><span class="s1">'fontsize'</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Share of EV Charging Stations by Region (2024)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Combine total sales from all datasets</span>
<span class="n">total_sales</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">],</span>
    <span class="s1">'2-Wheelers'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'3-Wheelers'</span><span class="p">:</span> <span class="n">ev3w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'4-Wheelers'</span><span class="p">:</span> <span class="n">ev4w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span>
    <span class="s1">'Buses'</span><span class="p">:</span> <span class="n">evbus</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">total_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">total_sales</span><span class="p">)</span>

<span class="n">total_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'Year'</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">'bar'</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Yearly Total Sales Comparison'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Total Sales'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_ev_data</span><span class="p">():</span>
    <span class="c1"># Loading the datasets</span>
    <span class="n">ev2w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_2_Wheeler_Sales.csv"</span><span class="p">)</span>
    <span class="n">ev3w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_3_Wheeler_Sales.csv"</span><span class="p">)</span>
    <span class="n">ev4w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_4_Wheeler_Sales.csv"</span><span class="p">)</span>
    <span class="n">evbus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electric_Bus_Sales.csv"</span><span class="p">)</span>
    <span class="n">electrical_consumption</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"Electrical_Consumptiondataa.csv"</span><span class="p">)</span>
    
    <span class="c1"># Create charging stations dataframe</span>
    <span class="n">charging_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">"Andhra Pradesh"</span><span class="p">,</span> <span class="mi">327</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Arunachal Pradesh"</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Assam"</span><span class="p">,</span> <span class="mi">86</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Bihar"</span><span class="p">,</span> <span class="mi">124</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Chandigarh"</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Delhi"</span><span class="p">,</span> <span class="mi">1886</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Gujarat"</span><span class="p">,</span> <span class="mi">476</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Haryana"</span><span class="p">,</span> <span class="mi">377</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Karnataka"</span><span class="p">,</span> <span class="mi">1041</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Kerala"</span><span class="p">,</span> <span class="mi">852</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Madhya Pradesh"</span><span class="p">,</span> <span class="mi">341</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Maharashtra"</span><span class="p">,</span> <span class="mi">3079</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Odisha"</span><span class="p">,</span> <span class="mi">198</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Rajasthan"</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Tamil Nadu"</span><span class="p">,</span> <span class="mi">643</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Telangana"</span><span class="p">,</span> <span class="mi">481</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Uttar Pradesh"</span><span class="p">,</span> <span class="mi">582</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"West Bengal"</span><span class="p">,</span> <span class="mi">318</span><span class="p">]</span>
    <span class="p">]</span>
    
    <span class="n">charging_stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">charging_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'State'</span><span class="p">,</span> <span class="s1">'Operational_PCS'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ev2w</span><span class="p">,</span> <span class="n">ev3w</span><span class="p">,</span> <span class="n">ev4w</span><span class="p">,</span> <span class="n">evbus</span><span class="p">,</span> <span class="n">electrical_consumption</span><span class="p">,</span> <span class="n">charging_stations</span>

<span class="k">def</span> <span class="nf">plot_ev_sales_trends</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Plot and display EV sales trends"""</span>
    <span class="n">ev2w</span><span class="p">,</span> <span class="n">ev3w</span><span class="p">,</span> <span class="n">ev4w</span><span class="p">,</span> <span class="n">evbus</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_ev_data</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Plot yearly totals for complete years only</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">ev2w</span><span class="p">[</span><span class="n">ev2w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()][</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'#FF6B6B'</span><span class="p">,</span> <span class="s1">'#4ECDC4'</span><span class="p">,</span> <span class="s1">'#45B7D1'</span><span class="p">,</span> <span class="s1">'#96CEB4'</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([(</span><span class="n">ev2w</span><span class="p">,</span> <span class="s1">'2 Wheelers'</span><span class="p">),</span> 
                                 <span class="p">(</span><span class="n">ev3w</span><span class="p">,</span> <span class="s1">'3 Wheelers'</span><span class="p">),</span> 
                                 <span class="p">(</span><span class="n">ev4w</span><span class="p">,</span> <span class="s1">'4 Wheelers'</span><span class="p">),</span> 
                                 <span class="p">(</span><span class="n">evbus</span><span class="p">,</span> <span class="s1">'Buses'</span><span class="p">)],</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)][</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">totals</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'EV Sales Trends by Vehicle Type (2018-2025)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Fiscal Year'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Total Sales (Log Scale)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">ev2w</span><span class="p">,</span> <span class="s1">'2W'</span><span class="p">),</span> <span class="p">(</span><span class="n">ev3w</span><span class="p">,</span> <span class="s1">'3W'</span><span class="p">),</span> <span class="p">(</span><span class="n">ev4w</span><span class="p">,</span> <span class="s1">'4W'</span><span class="p">),</span> <span class="p">(</span><span class="n">evbus</span><span class="p">,</span> <span class="s1">'Bus'</span><span class="p">)]:</span>
        <span class="n">totals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years</span><span class="p">)][</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">totals</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> 
                           <span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">value</span><span class="p">),</span>
                           <span class="n">textcoords</span><span class="o">=</span><span class="s2">"offset points"</span><span class="p">,</span>
                           <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                           <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span>
                           <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    

<span class="k">def</span> <span class="nf">plot_charging_infrastructure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Plot and display charging infrastructure analysis"""</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">electrical_consumption</span><span class="p">,</span> <span class="n">charging_stations</span> <span class="o">=</span> <span class="n">load_ev_data</span><span class="p">()</span>
    
    <span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">electrical_consumption</span><span class="p">,</span> <span class="n">charging_stations</span><span class="p">,</span> 
                          <span class="n">left_on</span><span class="o">=</span><span class="s1">'Region'</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'inner'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Create scatter plot</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Operational_PCS'</span><span class="p">],</span> 
                         <span class="n">merged_data</span><span class="p">[</span><span class="s1">'Total Electricity Consumed(in MU)'</span><span class="p">],</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                         <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">c</span><span class="o">=</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Total Electricity Consumed(in MU)'</span><span class="p">],</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Region'</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> 
                    <span class="p">(</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Operational_PCS'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                     <span class="n">merged_data</span><span class="p">[</span><span class="s1">'Total Electricity Consumed(in MU)'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                    <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">textcoords</span><span class="o">=</span><span class="s1">'offset points'</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">))</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Total Electricity Consumed (MU)'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Operational Charging Stations'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Total Electricity Consumed (MU)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Charging Infrastructure vs Electricity electrical_Consumption by State'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
   
<span class="k">def</span> <span class="nf">train_sales_prediction_model</span><span class="p">():</span>
    <span class="n">ev2w</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_ev_data</span><span class="p">()</span>

    <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Apr'</span><span class="p">,</span> <span class="s1">'May'</span><span class="p">,</span> <span class="s1">'Jun'</span><span class="p">,</span> <span class="s1">'Jul'</span><span class="p">,</span> <span class="s1">'Aug'</span><span class="p">,</span> <span class="s1">'Sep'</span><span class="p">,</span> <span class="s1">'Oct'</span><span class="p">,</span> <span class="s1">'Nov'</span><span class="p">,</span> <span class="s1">'Dec'</span><span class="p">,</span> <span class="s1">'Jan'</span><span class="p">,</span> <span class="s1">'Feb'</span><span class="p">]</span>
    <span class="n">target</span> <span class="o">=</span> <span class="s1">'Mar'</span>
    
    <span class="n">complete_data</span> <span class="o">=</span> <span class="n">ev2w</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">features</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">])</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">complete_data</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">complete_data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># Split data</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    
    <span class="c1"># Scale features</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># Train models</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'Linear Regression'</span><span class="p">:</span> <span class="n">LinearRegression</span><span class="p">(),</span>
        <span class="s1">'Random Forest'</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'R2 Score'</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="s1">'RMSE'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">results</span>

<span class="k">def</span> <span class="nf">analyze_charging_density</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Plot and display charging station density analysis"""</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">charging_stations</span> <span class="o">=</span> <span class="n">load_ev_data</span><span class="p">()</span>
    
    <span class="c1"># Population data</span>
    <span class="n">population_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">"Andhra Pradesh"</span><span class="p">,</span> <span class="mf">54.02</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Arunachal Pradesh"</span><span class="p">,</span> <span class="mf">1.64</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Assam"</span><span class="p">,</span> <span class="mf">36.19</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Bihar"</span><span class="p">,</span> <span class="mf">141.06</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Chandigarh"</span><span class="p">,</span> <span class="mf">1.27</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Delhi"</span><span class="p">,</span> <span class="mf">21.05</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Gujarat"</span><span class="p">,</span> <span class="mf">74.81</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Haryana"</span><span class="p">,</span> <span class="mf">32.17</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Karnataka"</span><span class="p">,</span> <span class="mf">72.36</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Kerala"</span><span class="p">,</span> <span class="mf">36.01</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Madhya Pradesh"</span><span class="p">,</span> <span class="mf">90.02</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Maharashtra"</span><span class="p">,</span> <span class="mf">127.14</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Odisha"</span><span class="p">,</span> <span class="mf">48.72</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Rajasthan"</span><span class="p">,</span> <span class="mf">84.29</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Tamil Nadu"</span><span class="p">,</span> <span class="mf">79.25</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Telangana"</span><span class="p">,</span> <span class="mf">41.48</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"Uttar Pradesh"</span><span class="p">,</span> <span class="mf">248.96</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">"West Bengal"</span><span class="p">,</span> <span class="mf">102.72</span><span class="p">]</span>
    <span class="p">]</span>
    
    <span class="n">population_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">population_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'State'</span><span class="p">,</span> <span class="s1">'Population_Millions'</span><span class="p">])</span>
    
    <span class="c1"># Calculate density metrics</span>
    <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">charging_stations</span><span class="p">,</span> <span class="n">population_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'State'</span><span class="p">)</span>
    <span class="n">merged_df</span><span class="p">[</span><span class="s1">'Stations_per_Million'</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">'Operational_PCS'</span><span class="p">]</span> <span class="o">/</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">'Population_Millions'</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Create bar plot with custom colors</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">merged_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'Stations_per_Million'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                      <span class="n">x</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">'Stations_per_Million'</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span>
                      <span class="n">palette</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'right'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bars</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">(),</span>
                <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">'bottom'</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'EV Charging Stations per Million Population by State'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'State'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Charging Stations per Million People'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Main execution</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Generating visualizations...</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">"1. Plotting EV Sales Trends..."</span><span class="p">)</span>
        <span class="n">plot_ev_sales_trends</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">2. Plotting Charging Infrastructure Analysis..."</span><span class="p">)</span>
        <span class="n">plot_charging_infrastructure</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">3. Plotting Charging Station Density Analysis..."</span><span class="p">)</span>
        <span class="n">analyze_charging_density</span><span class="p">()</span>
        
        <span class="c1"># Train and display ML results</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Training Machine Learning Models..."</span><span class="p">)</span>
        <span class="n">ml_results</span> <span class="o">=</span> <span class="n">train_sales_prediction_model</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Machine Learning Model Results:"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">metrics</span> <span class="ow">in</span> <span class="n">ml_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"An error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">ev2w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Electric_2_Wheeler_Sales.csv'</span><span class="p">)</span>
<span class="n">ev3w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Electric_3_Wheeler_Sales.csv'</span><span class="p">)</span>
<span class="n">ev4w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Electric_4_Wheeler_Sales.csv'</span><span class="p">)</span>
<span class="n">evbus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Electric_Bus_Sales.csv'</span><span class="p">)</span>
<span class="n">electricity_consumption</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'Electrical_Consumptiondataa.csv'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">preprocess_sales_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    
    <span class="n">df_melted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'S.No'</span><span class="p">,</span> <span class="s1">'Year'</span><span class="p">],</span> 
                         <span class="n">var_name</span><span class="o">=</span><span class="s1">'Month'</span><span class="p">,</span> 
                         <span class="n">value_name</span><span class="o">=</span><span class="s1">'Sales'</span><span class="p">)</span>
    <span class="n">df_melted</span> <span class="o">=</span> <span class="n">df_melted</span><span class="p">[</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'Total'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df_melted</span>

<span class="c1"># 1. Time Series Analysis with Decomposition</span>
<span class="k">def</span> <span class="nf">time_series_decomposition</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># Aggregate monthly sales</span>
    <span class="n">monthly_sales</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'Year'</span><span class="p">,</span> <span class="s1">'Month'</span><span class="p">])[</span><span class="s1">'Sales'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'FY'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'-'</span> <span class="o">+</span> 
                                            <span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'%y-%b'</span><span class="p">)</span>
    <span class="n">monthly_sales</span> <span class="o">=</span> <span class="n">monthly_sales</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'Date'</span><span class="p">)</span>
    
    <span class="c1"># Decomposition</span>
    <span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Sales'</span><span class="p">],</span> <span class="n">period</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">],</span> <span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Sales'</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> - Original Time Series'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Trend'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">seasonal</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Seasonal'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_sales</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Residual'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">ev2w_melted</span> <span class="o">=</span> <span class="n">preprocess_sales_data</span><span class="p">(</span><span class="n">ev2w</span><span class="p">)</span>
<span class="n">ev3w_melted</span> <span class="o">=</span> <span class="n">preprocess_sales_data</span><span class="p">(</span><span class="n">ev3w</span><span class="p">)</span>
<span class="n">ev4w_melted</span> <span class="o">=</span> <span class="n">preprocess_sales_data</span><span class="p">(</span><span class="n">ev4w</span><span class="p">)</span>
<span class="n">evbus_melted</span> <span class="o">=</span> <span class="n">preprocess_sales_data</span><span class="p">(</span><span class="n">evbus</span><span class="p">)</span>

<span class="c1"># Datasets for analysis</span>
<span class="n">sales_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Two Wheeler'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">,</span>
    <span class="s1">'Three Wheeler'</span><span class="p">:</span> <span class="n">ev3w</span><span class="p">,</span>
    <span class="s1">'Four Wheeler'</span><span class="p">:</span> <span class="n">ev4w</span><span class="p">,</span>
    <span class="s1">'Bus'</span><span class="p">:</span> <span class="n">evbus</span>
<span class="p">}</span>

<span class="c1"># Run analyses</span>
<span class="n">time_series_decomposition</span><span class="p">(</span><span class="n">ev2w_melted</span><span class="p">,</span> <span class="s1">'Two Wheeler Sales'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">charging_stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'State'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Andaman &amp; Nicobar'</span><span class="p">,</span> <span class="s1">'Andhra Pradesh'</span><span class="p">,</span> <span class="s1">'Arunachal Pradesh'</span><span class="p">,</span> <span class="s1">'Assam'</span><span class="p">,</span> <span class="s1">'Bihar'</span><span class="p">,</span> 
             <span class="s1">'Chandigarh'</span><span class="p">,</span> <span class="s1">'Chhattisgarh'</span><span class="p">,</span> <span class="s1">'D&amp;D and DNH'</span><span class="p">,</span> <span class="s1">'Delhi'</span><span class="p">,</span> <span class="s1">'Goa'</span><span class="p">,</span> <span class="s1">'Gujarat'</span><span class="p">,</span> <span class="s1">'Haryana'</span><span class="p">,</span>
             <span class="s1">'Himachal Pradesh'</span><span class="p">,</span> <span class="s1">'Jammu &amp; Kashmir'</span><span class="p">,</span> <span class="s1">'Jharkhand'</span><span class="p">,</span> <span class="s1">'Karnataka'</span><span class="p">,</span> <span class="s1">'Kerala'</span><span class="p">,</span> 
             <span class="s1">'Lakshadweep'</span><span class="p">,</span> <span class="s1">'Madhya Pradesh'</span><span class="p">,</span> <span class="s1">'Maharashtra'</span><span class="p">,</span> <span class="s1">'Manipur'</span><span class="p">,</span> <span class="s1">'Meghalaya'</span><span class="p">,</span> <span class="s1">'Nagaland'</span><span class="p">,</span>
             <span class="s1">'Odisha'</span><span class="p">,</span> <span class="s1">'Pondicherry'</span><span class="p">,</span> <span class="s1">'Punjab'</span><span class="p">,</span> <span class="s1">'Rajasthan'</span><span class="p">,</span> <span class="s1">'Sikkim'</span><span class="p">,</span> <span class="s1">'Tamil Nadu'</span><span class="p">,</span> <span class="s1">'Telangana'</span><span class="p">,</span>
             <span class="s1">'Tripura'</span><span class="p">,</span> <span class="s1">'Uttar Pradesh'</span><span class="p">,</span> <span class="s1">'Uttarakhand'</span><span class="p">,</span> <span class="s1">'West Bengal'</span><span class="p">],</span>
    <span class="s1">'Charging_Stations'</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1886</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span>
                         <span class="mi">1041</span><span class="p">,</span> <span class="mi">852</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">3079</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">643</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span>
                         <span class="mi">18</span><span class="p">,</span> <span class="mi">582</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">318</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">population</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'State'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Andhra Pradesh'</span><span class="p">,</span> <span class="s1">'Arunachal Pradesh'</span><span class="p">,</span> <span class="s1">'Assam'</span><span class="p">,</span> <span class="s1">'Bihar'</span><span class="p">,</span> <span class="s1">'Chandigarh'</span><span class="p">,</span>
              <span class="s1">'Chhattisgarh'</span><span class="p">,</span> <span class="s1">'Delhi'</span><span class="p">,</span> <span class="s1">'Goa'</span><span class="p">,</span> <span class="s1">'Gujarat'</span><span class="p">,</span> <span class="s1">'Haryana'</span><span class="p">,</span> <span class="s1">'Himachal Pradesh'</span><span class="p">,</span>
              <span class="s1">'Jammu &amp; Kashmir'</span><span class="p">,</span> <span class="s1">'Jharkhand'</span><span class="p">,</span> <span class="s1">'Karnataka'</span><span class="p">,</span> <span class="s1">'Kerala'</span><span class="p">,</span> <span class="s1">'Madhya Pradesh'</span><span class="p">,</span>
              <span class="s1">'Maharashtra'</span><span class="p">,</span> <span class="s1">'Manipur'</span><span class="p">,</span> <span class="s1">'Meghalaya'</span><span class="p">,</span> <span class="s1">'Mizoram'</span><span class="p">,</span> <span class="s1">'Nagaland'</span><span class="p">,</span> <span class="s1">'Odisha'</span><span class="p">,</span>
              <span class="s1">'Punjab'</span><span class="p">,</span> <span class="s1">'Rajasthan'</span><span class="p">,</span> <span class="s1">'Sikkim'</span><span class="p">,</span> <span class="s1">'Tamil Nadu'</span><span class="p">,</span> <span class="s1">'Telangana'</span><span class="p">,</span> <span class="s1">'Tripura'</span><span class="p">,</span>
              <span class="s1">'Uttar Pradesh'</span><span class="p">,</span> <span class="s1">'Uttarakhand'</span><span class="p">,</span> <span class="s1">'West Bengal'</span><span class="p">],</span>
    <span class="s1">'Population'</span><span class="p">:</span> <span class="p">[</span><span class="mf">54.02</span><span class="p">,</span> <span class="mf">1.64</span><span class="p">,</span> <span class="mf">36.19</span><span class="p">,</span> <span class="mf">141.06</span><span class="p">,</span> <span class="mf">1.27</span><span class="p">,</span> <span class="mf">31.03</span><span class="p">,</span> <span class="mf">21.05</span><span class="p">,</span> <span class="mf">1.67</span><span class="p">,</span> <span class="mf">74.81</span><span class="p">,</span> <span class="mf">32.17</span><span class="p">,</span>
                  <span class="mf">7.65</span><span class="p">,</span> <span class="mf">14.31</span><span class="p">,</span> <span class="mf">41.64</span><span class="p">,</span> <span class="mf">72.36</span><span class="p">,</span> <span class="mf">36.01</span><span class="p">,</span> <span class="mf">90.02</span><span class="p">,</span> <span class="mf">127.14</span><span class="p">,</span> <span class="mf">3.24</span><span class="p">,</span> <span class="mf">4.14</span><span class="p">,</span> <span class="mf">1.28</span><span class="p">,</span>
                  <span class="mf">2.29</span><span class="p">,</span> <span class="mf">48.72</span><span class="p">,</span> <span class="mf">31.72</span><span class="p">,</span> <span class="mf">84.29</span><span class="p">,</span> <span class="mf">0.71</span><span class="p">,</span> <span class="mf">79.25</span><span class="p">,</span> <span class="mf">41.48</span><span class="p">,</span> <span class="mf">4.46</span><span class="p">,</span> <span class="mf">248.96</span><span class="p">,</span> <span class="mf">12.36</span><span class="p">,</span> <span class="mf">102.72</span><span class="p">]})</span>


<span class="n">elec_consumption</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'State'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Chandigarh'</span><span class="p">,</span> <span class="s1">'Delhi'</span><span class="p">,</span> <span class="s1">'Haryana'</span><span class="p">,</span> <span class="s1">'Rajasthan'</span><span class="p">,</span> <span class="s1">'Uttar Pradesh'</span><span class="p">,</span> <span class="s1">'Gujarat'</span><span class="p">,</span>
             <span class="s1">'Madhya Pradesh'</span><span class="p">,</span> <span class="s1">'Maharashtra'</span><span class="p">,</span> <span class="s1">'Andhra Pradesh'</span><span class="p">,</span> <span class="s1">'Karnataka'</span><span class="p">,</span> <span class="s1">'Kerala'</span><span class="p">,</span>
             <span class="s1">'Tamil Nadu'</span><span class="p">,</span> <span class="s1">'Telangana'</span><span class="p">,</span> <span class="s1">'Bihar'</span><span class="p">,</span> <span class="s1">'Odisha'</span><span class="p">,</span> <span class="s1">'West Bengal'</span><span class="p">,</span> <span class="s1">'Assam'</span><span class="p">],</span>
    <span class="s1">'Regular_Consumption'</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">61.25</span><span class="p">,</span> <span class="mf">9.16</span><span class="p">,</span> <span class="mf">2.96</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.21</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">8.92</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> 
                          <span class="mf">2.88</span><span class="p">,</span> <span class="mf">5.37</span><span class="p">,</span> <span class="mf">4.84</span><span class="p">,</span> <span class="mf">2.07</span><span class="p">,</span> <span class="mf">2.93</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">],</span>
    <span class="s1">'Heavy_Duty_Consumption'</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.88</span><span class="p">,</span> <span class="mf">84.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">23.96</span><span class="p">,</span> <span class="mf">1.29</span><span class="p">,</span> <span class="mf">62.81</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span>
                             <span class="mf">1.48</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.67</span><span class="p">,</span> <span class="mf">1.14</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">4.49</span><span class="p">]</span>
<span class="p">})</span>


<span class="n">ev_2w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY18'</span><span class="p">,</span> <span class="s1">'FY19'</span><span class="p">,</span> <span class="s1">'FY20'</span><span class="p">,</span> <span class="s1">'FY21'</span><span class="p">,</span> <span class="s1">'FY22'</span><span class="p">,</span> <span class="s1">'FY23'</span><span class="p">,</span> <span class="s1">'FY24'</span><span class="p">,</span> <span class="s1">'FY25'</span><span class="p">],</span>
    <span class="s1">'Total'</span><span class="p">:</span> <span class="p">[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">28007</span><span class="p">,</span> <span class="mi">26834</span><span class="p">,</span> <span class="mi">44803</span><span class="p">,</span> <span class="mi">252641</span><span class="p">,</span> <span class="mi">728054</span><span class="p">,</span> <span class="mi">944126</span><span class="p">,</span> <span class="mi">590652</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_3w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY18'</span><span class="p">,</span> <span class="s1">'FY19'</span><span class="p">,</span> <span class="s1">'FY20'</span><span class="p">,</span> <span class="s1">'FY21'</span><span class="p">,</span> <span class="s1">'FY22'</span><span class="p">,</span> <span class="s1">'FY23'</span><span class="p">,</span> <span class="s1">'FY24'</span><span class="p">,</span> <span class="s1">'FY25'</span><span class="p">],</span>
    <span class="s1">'Total'</span><span class="p">:</span> <span class="p">[</span><span class="mi">91970</span><span class="p">,</span> <span class="mi">116031</span><span class="p">,</span> <span class="mi">143051</span><span class="p">,</span> <span class="mi">90898</span><span class="p">,</span> <span class="mi">172543</span><span class="p">,</span> <span class="mi">401882</span><span class="p">,</span> <span class="mi">632485</span><span class="p">,</span> <span class="mi">378394</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_4w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY18'</span><span class="p">,</span> <span class="s1">'FY19'</span><span class="p">,</span> <span class="s1">'FY20'</span><span class="p">,</span> <span class="s1">'FY21'</span><span class="p">,</span> <span class="s1">'FY22'</span><span class="p">,</span> <span class="s1">'FY23'</span><span class="p">,</span> <span class="s1">'FY24'</span><span class="p">,</span> <span class="s1">'FY25'</span><span class="p">],</span>
    <span class="s1">'Total'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1204</span><span class="p">,</span> <span class="mi">1885</span><span class="p">,</span> <span class="mi">2377</span><span class="p">,</span> <span class="mi">5154</span><span class="p">,</span> <span class="mi">18622</span><span class="p">,</span> <span class="mi">47499</span><span class="p">,</span> <span class="mi">90432</span><span class="p">,</span> <span class="mi">49306</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_bus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY18'</span><span class="p">,</span> <span class="s1">'FY19'</span><span class="p">,</span> <span class="s1">'FY20'</span><span class="p">,</span> <span class="s1">'FY21'</span><span class="p">,</span> <span class="s1">'FY22'</span><span class="p">,</span> <span class="s1">'FY23'</span><span class="p">,</span> <span class="s1">'FY24'</span><span class="p">,</span> <span class="s1">'FY25'</span><span class="p">],</span>
    <span class="s1">'Total'</span><span class="p">:</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">434</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">1194</span><span class="p">,</span> <span class="mi">1984</span><span class="p">,</span> <span class="mi">3693</span><span class="p">,</span> <span class="mi">1981</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Prepare monthly data for all vehicle type</span>
<span class="k">def</span> <span class="nf">prepare_monthly_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Apr'</span><span class="p">,</span> <span class="s1">'May'</span><span class="p">,</span> <span class="s1">'Jun'</span><span class="p">,</span> <span class="s1">'Jul'</span><span class="p">,</span> <span class="s1">'Aug'</span><span class="p">,</span> <span class="s1">'Sep'</span><span class="p">,</span> <span class="s1">'Oct'</span><span class="p">,</span> <span class="s1">'Nov'</span><span class="p">,</span> <span class="s1">'Dec'</span><span class="p">,</span> <span class="s1">'Jan'</span><span class="p">,</span> <span class="s1">'Feb'</span><span class="p">,</span> <span class="s1">'Mar'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">months</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Create DataFrames for each vehicle type including monthly data</span>
<span class="n">ev_2w_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY24'</span><span class="p">],</span>
    <span class="s1">'Apr'</span><span class="p">:</span> <span class="p">[</span><span class="mi">66877</span><span class="p">],</span> <span class="s1">'May'</span><span class="p">:</span> <span class="p">[</span><span class="mi">105582</span><span class="p">],</span> <span class="s1">'Jun'</span><span class="p">:</span> <span class="p">[</span><span class="mi">46106</span><span class="p">],</span> <span class="s1">'Jul'</span><span class="p">:</span> <span class="p">[</span><span class="mi">54614</span><span class="p">],</span>
    <span class="s1">'Aug'</span><span class="p">:</span> <span class="p">[</span><span class="mi">62767</span><span class="p">],</span> <span class="s1">'Sep'</span><span class="p">:</span> <span class="p">[</span><span class="mi">64077</span><span class="p">],</span> <span class="s1">'Oct'</span><span class="p">:</span> <span class="p">[</span><span class="mi">75144</span><span class="p">],</span> <span class="s1">'Nov'</span><span class="p">:</span> <span class="p">[</span><span class="mi">92018</span><span class="p">],</span>
    <span class="s1">'Dec'</span><span class="p">:</span> <span class="p">[</span><span class="mi">75855</span><span class="p">],</span> <span class="s1">'Jan'</span><span class="p">:</span> <span class="p">[</span><span class="mi">82018</span><span class="p">],</span> <span class="s1">'Feb'</span><span class="p">:</span> <span class="p">[</span><span class="mi">82508</span><span class="p">],</span> <span class="s1">'Mar'</span><span class="p">:</span> <span class="p">[</span><span class="mi">136560</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_3w_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY24'</span><span class="p">],</span>
    <span class="s1">'Apr'</span><span class="p">:</span> <span class="p">[</span><span class="mi">38083</span><span class="p">],</span> <span class="s1">'May'</span><span class="p">:</span> <span class="p">[</span><span class="mi">44698</span><span class="p">],</span> <span class="s1">'Jun'</span><span class="p">:</span> <span class="p">[</span><span class="mi">48151</span><span class="p">],</span> <span class="s1">'Jul'</span><span class="p">:</span> <span class="p">[</span><span class="mi">53877</span><span class="p">],</span>
    <span class="s1">'Aug'</span><span class="p">:</span> <span class="p">[</span><span class="mi">56860</span><span class="p">],</span> <span class="s1">'Sep'</span><span class="p">:</span> <span class="p">[</span><span class="mi">57547</span><span class="p">],</span> <span class="s1">'Oct'</span><span class="p">:</span> <span class="p">[</span><span class="mi">57006</span><span class="p">],</span> <span class="s1">'Nov'</span><span class="p">:</span> <span class="p">[</span><span class="mi">53912</span><span class="p">],</span>
    <span class="s1">'Dec'</span><span class="p">:</span> <span class="p">[</span><span class="mi">57653</span><span class="p">],</span> <span class="s1">'Jan'</span><span class="p">:</span> <span class="p">[</span><span class="mi">53459</span><span class="p">],</span> <span class="s1">'Feb'</span><span class="p">:</span> <span class="p">[</span><span class="mi">50598</span><span class="p">],</span> <span class="s1">'Mar'</span><span class="p">:</span> <span class="p">[</span><span class="mi">60641</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_4w_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY24'</span><span class="p">],</span>
    <span class="s1">'Apr'</span><span class="p">:</span> <span class="p">[</span><span class="mi">6041</span><span class="p">],</span> <span class="s1">'May'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7718</span><span class="p">],</span> <span class="s1">'Jun'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7974</span><span class="p">],</span> <span class="s1">'Jul'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7771</span><span class="p">],</span>
    <span class="s1">'Aug'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7016</span><span class="p">],</span> <span class="s1">'Sep'</span><span class="p">:</span> <span class="p">[</span><span class="mi">6365</span><span class="p">],</span> <span class="s1">'Oct'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7602</span><span class="p">],</span> <span class="s1">'Nov'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7526</span><span class="p">],</span>
    <span class="s1">'Dec'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7490</span><span class="p">],</span> <span class="s1">'Jan'</span><span class="p">:</span> <span class="p">[</span><span class="mi">8440</span><span class="p">],</span> <span class="s1">'Feb'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7438</span><span class="p">],</span> <span class="s1">'Mar'</span><span class="p">:</span> <span class="p">[</span><span class="mi">9051</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">ev_bus_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Year'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'FY24'</span><span class="p">],</span>
    <span class="s1">'Apr'</span><span class="p">:</span> <span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="s1">'May'</span><span class="p">:</span> <span class="p">[</span><span class="mi">280</span><span class="p">],</span> <span class="s1">'Jun'</span><span class="p">:</span> <span class="p">[</span><span class="mi">204</span><span class="p">],</span> <span class="s1">'Jul'</span><span class="p">:</span> <span class="p">[</span><span class="mi">144</span><span class="p">],</span>
    <span class="s1">'Aug'</span><span class="p">:</span> <span class="p">[</span><span class="mi">269</span><span class="p">],</span> <span class="s1">'Sep'</span><span class="p">:</span> <span class="p">[</span><span class="mi">258</span><span class="p">],</span> <span class="s1">'Oct'</span><span class="p">:</span> <span class="p">[</span><span class="mi">239</span><span class="p">],</span> <span class="s1">'Nov'</span><span class="p">:</span> <span class="p">[</span><span class="mi">268</span><span class="p">],</span>
    <span class="s1">'Dec'</span><span class="p">:</span> <span class="p">[</span><span class="mi">577</span><span class="p">],</span> <span class="s1">'Jan'</span><span class="p">:</span> <span class="p">[</span><span class="mi">549</span><span class="p">],</span> <span class="s1">'Feb'</span><span class="p">:</span> <span class="p">[</span><span class="mi">345</span><span class="p">],</span> <span class="s1">'Mar'</span><span class="p">:</span> <span class="p">[</span><span class="mi">472</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Create combined DataFrame with electricity consumption and charging stations</span>
<span class="n">elec_stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">charging_stations</span><span class="p">,</span>
    <span class="n">elec_consumption</span><span class="p">,</span>
    <span class="n">left_on</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span>
    <span class="n">right_on</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span>
    <span class="n">how</span><span class="o">=</span><span class="s1">'inner'</span>
<span class="p">)</span>

<span class="c1"># Create figure with complex grid layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'seaborn-v0_8-dark'</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># 1. Radar Chart comparing EV adoption metrics across states</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">projection</span><span class="o">=</span><span class="s1">'polar'</span><span class="p">)</span>
<span class="n">top_states</span> <span class="o">=</span> <span class="n">elec_stations</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">'Charging_Stations'</span><span class="p">)</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_states</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Charging_Stations'</span><span class="p">,</span> <span class="s1">'Regular_Consumption'</span><span class="p">,</span> <span class="s1">'Heavy_Duty_Consumption'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">top_states</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span> <span class="o">-</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
    <span class="n">angles_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">angles</span><span class="p">,</span> <span class="p">[</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angles_plot</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="s1">'-o'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">angles_plot</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">top_states</span><span class="p">[</span><span class="s1">'State'</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Top States: Infrastructure and Consumption Comparison'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Create figure with complex grid layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'seaborn-v0_8-dark'</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>

<span class="c1"># 1. Stacked Area Chart showing EV adoption trends</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">ev_2w</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span>
<span class="n">data_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">ev_2w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span> <span class="n">ev_3w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span> 
                       <span class="n">ev_4w</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">],</span> <span class="n">ev_bus</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'2-Wheelers'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'3-Wheelers'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'4-Wheelers'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data_stack</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Buses'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Evolution of EV Adoption by Vehicle Type'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Fiscal Year'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Number of Vehicles (Log Scale)'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Calculate and add CAGR annotations</span>
<span class="k">def</span> <span class="nf">calculate_cagr</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">periods</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">final</span><span class="o">/</span><span class="n">initial</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">periods</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ev_2w</span><span class="p">,</span> <span class="n">ev_3w</span><span class="p">,</span> <span class="n">ev_4w</span><span class="p">,</span> <span class="n">ev_bus</span><span class="p">]):</span>
    <span class="n">cagr</span> <span class="o">=</span> <span class="n">calculate_cagr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">'CAGR: </span><span class="si">{</span><span class="n">cagr</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%'</span><span class="p">,</span> 
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">-</span><span class="n">i</span><span class="o">*</span><span class="mf">0.05</span><span class="p">),</span> 
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">'axes fraction'</span><span class="p">)</span>


<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">elec_consumption</span><span class="p">[</span><span class="s1">'Total_Consumption'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">elec_consumption</span><span class="p">[</span><span class="s1">'Regular_Consumption'</span><span class="p">]</span> <span class="o">+</span> 
                                       <span class="n">elec_consumption</span><span class="p">[</span><span class="s1">'Heavy_Duty_Consumption'</span><span class="p">])</span>
<span class="n">elec_consumption_pivot</span> <span class="o">=</span> <span class="n">elec_consumption</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">'Regular_Consumption'</span><span class="p">,</span> <span class="s1">'Heavy_Duty_Consumption'</span><span class="p">,</span> <span class="s1">'Total_Consumption'</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">'State'</span>
<span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">elec_consumption_pivot</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="s1">'YlOrRd'</span><span class="p">,</span>
            <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s1">'.2f'</span><span class="p">,</span>
            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Electricity Consumption (MU)'</span><span class="p">},</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'State-wise Electricity Consumption Pattern</span><span class="se">\n</span><span class="s1">for EV Charging'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Bubble Chart showing relationship between different metrics</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">elec_consumption</span><span class="p">,</span> 
                      <span class="n">charging_stations</span><span class="p">[[</span><span class="s1">'State'</span><span class="p">,</span> <span class="s1">'Charging_Stations'</span><span class="p">]],</span> 
                      <span class="n">on</span><span class="o">=</span><span class="s1">'State'</span><span class="p">,</span> 
                      <span class="n">how</span><span class="o">=</span><span class="s1">'inner'</span><span class="p">)</span>

<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Total_Consumption'</span><span class="p">],</span>
                     <span class="n">merged_data</span><span class="p">[</span><span class="s1">'Charging_Stations'</span><span class="p">],</span>
                     <span class="n">s</span><span class="o">=</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Heavy_Duty_Consumption'</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span>
                     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">merged_data</span><span class="p">[</span><span class="s1">'Regular_Consumption'</span><span class="p">],</span>
                     <span class="n">cmap</span><span class="o">=</span><span class="s1">'viridis'</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Total Electricity Consumption (MU)'</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Number of Charging Stations'</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Relationship between Charging Infrastructure</span><span class="se">\n</span><span class="s1">and Electricity Consumption'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Add legend for bubble size</span>
<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">s</span><span class="o">/</span><span class="mi">100</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> MU'</span><span class="p">,</span>
                             <span class="n">c</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]]</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">'Heavy Duty Consumption'</span><span class="p">,</span>
          <span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Regular Consumption (MU)'</span><span class="p">)</span>

<span class="c1"># 4. Monthly Trend Analysis</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>

<span class="c1"># Create monthly data for FY24</span>
<span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Apr'</span><span class="p">,</span> <span class="s1">'May'</span><span class="p">,</span> <span class="s1">'Jun'</span><span class="p">,</span> <span class="s1">'Jul'</span><span class="p">,</span> <span class="s1">'Aug'</span><span class="p">,</span> <span class="s1">'Sep'</span><span class="p">,</span> <span class="s1">'Oct'</span><span class="p">,</span> <span class="s1">'Nov'</span><span class="p">,</span> <span class="s1">'Dec'</span><span class="p">,</span> <span class="s1">'Jan'</span><span class="p">,</span> <span class="s1">'Feb'</span><span class="p">,</span> <span class="s1">'Mar'</span><span class="p">]</span>
<span class="n">fy24_2w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">66877</span><span class="p">,</span> <span class="mi">105582</span><span class="p">,</span> <span class="mi">46106</span><span class="p">,</span> <span class="mi">54614</span><span class="p">,</span> <span class="mi">62767</span><span class="p">,</span> <span class="mi">64077</span><span class="p">,</span> <span class="mi">75144</span><span class="p">,</span> <span class="mi">92018</span><span class="p">,</span> <span class="mi">75855</span><span class="p">,</span> <span class="mi">82018</span><span class="p">,</span> <span class="mi">82508</span><span class="p">,</span> <span class="mi">136560</span><span class="p">]</span>
<span class="n">fy24_3w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">38083</span><span class="p">,</span> <span class="mi">44698</span><span class="p">,</span> <span class="mi">48151</span><span class="p">,</span> <span class="mi">53877</span><span class="p">,</span> <span class="mi">56860</span><span class="p">,</span> <span class="mi">57547</span><span class="p">,</span> <span class="mi">57006</span><span class="p">,</span> <span class="mi">53912</span><span class="p">,</span> <span class="mi">57653</span><span class="p">,</span> <span class="mi">53459</span><span class="p">,</span> <span class="mi">50598</span><span class="p">,</span> <span class="mi">60641</span><span class="p">]</span>
<span class="n">fy24_4w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6041</span><span class="p">,</span> <span class="mi">7718</span><span class="p">,</span> <span class="mi">7974</span><span class="p">,</span> <span class="mi">7771</span><span class="p">,</span> <span class="mi">7016</span><span class="p">,</span> <span class="mi">6365</span><span class="p">,</span> <span class="mi">7602</span><span class="p">,</span> <span class="mi">7526</span><span class="p">,</span> <span class="mi">7490</span><span class="p">,</span> <span class="mi">8440</span><span class="p">,</span> <span class="mi">7438</span><span class="p">,</span> <span class="mi">9051</span><span class="p">]</span>
<span class="n">fy24_bus</span> <span class="o">=</span> <span class="p">[</span><span class="mi">88</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">258</span><span class="p">,</span> <span class="mi">239</span><span class="p">,</span> <span class="mi">268</span><span class="p">,</span> <span class="mi">577</span><span class="p">,</span> <span class="mi">549</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">472</span><span class="p">]</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">months</span><span class="p">,</span> <span class="n">fy24_2w</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'2-Wheelers'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">months</span><span class="p">,</span> <span class="n">fy24_3w</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'3-Wheelers'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">months</span><span class="p">,</span> <span class="n">fy24_4w</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'^'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'4-Wheelers'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">months</span><span class="p">,</span> <span class="n">fy24_bus</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'*'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Buses'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Monthly Sales Trends in FY24'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Month'</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Number of Vehicles Sold'</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># 5. Market Share Analysis</span>
<span class="n">ax5</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">market_share</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Vehicle_Type'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'2-Wheeler'</span><span class="p">,</span> <span class="s1">'3-Wheeler'</span><span class="p">,</span> <span class="s1">'4-Wheeler'</span><span class="p">,</span> <span class="s1">'Bus'</span><span class="p">],</span>
    <span class="s1">'FY24_Sales'</span><span class="p">:</span> <span class="p">[</span><span class="mi">944126</span><span class="p">,</span> <span class="mi">632485</span><span class="p">,</span> <span class="mi">90432</span><span class="p">,</span> <span class="mi">3693</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">market_share</span><span class="p">[</span><span class="s1">'Market_Share'</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_share</span><span class="p">[</span><span class="s1">'FY24_Sales'</span><span class="p">]</span> <span class="o">/</span> <span class="n">market_share</span><span class="p">[</span><span class="s1">'FY24_Sales'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Pastel1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_share</span><span class="p">)))</span>
<span class="n">wedges</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">autotexts</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">market_share</span><span class="p">[</span><span class="s1">'Market_Share'</span><span class="p">],</span>
                                  <span class="n">labels</span><span class="o">=</span><span class="n">market_share</span><span class="p">[</span><span class="s1">'Vehicle_Type'</span><span class="p">],</span>
                                  <span class="n">autopct</span><span class="o">=</span><span class="s1">'</span><span class="si">%1.1f%%</span><span class="s1">'</span><span class="p">,</span>
                                  <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                  <span class="n">explode</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">market_share</span><span class="p">))</span>

<span class="n">ax5</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Market Share Distribution in FY24'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Print Statistical Analysis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Statistical Analysis:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">1. Correlation Analysis:"</span><span class="p">)</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[[</span><span class="s1">'Total_Consumption'</span><span class="p">,</span> <span class="s1">'Charging_Stations'</span><span class="p">,</span> 
                         <span class="s1">'Regular_Consumption'</span><span class="p">,</span> <span class="s1">'Heavy_Duty_Consumption'</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">2. Growth Rates (FY23 to FY24):"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">vehicle_type</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">'2-Wheeler'</span><span class="p">,</span> <span class="s1">'3-Wheeler'</span><span class="p">,</span> <span class="s1">'4-Wheeler'</span><span class="p">,</span> <span class="s1">'Bus'</span><span class="p">],</span>
                            <span class="p">[</span><span class="n">ev_2w</span><span class="p">,</span> <span class="n">ev_3w</span><span class="p">,</span> <span class="n">ev_4w</span><span class="p">,</span> <span class="n">ev_bus</span><span class="p">]):</span>
    <span class="n">growth</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">'Total'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">vehicle_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">growth</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Dataset 1: Electricity Consumption</span>
<span class="n">data1</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Region"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Chandigarh"</span><span class="p">,</span> <span class="s2">"Delhi"</span><span class="p">,</span> <span class="s2">"Haryana"</span><span class="p">,</span> <span class="s2">"Rajasthan"</span><span class="p">,</span> <span class="s2">"Uttar Pradesh"</span><span class="p">,</span> <span class="s2">"Gujarat"</span><span class="p">,</span> 
               <span class="s2">"Madhya Pradesh"</span><span class="p">,</span> <span class="s2">"Maharashtra"</span><span class="p">,</span> <span class="s2">"Andhra Pradesh"</span><span class="p">,</span> <span class="s2">"Karnataka"</span><span class="p">,</span> <span class="s2">"Kerala"</span><span class="p">,</span> 
               <span class="s2">"Tamil Naidu"</span><span class="p">,</span> <span class="s2">"Telangana"</span><span class="p">,</span> <span class="s2">"Bihar"</span><span class="p">,</span> <span class="s2">"Odisha"</span><span class="p">,</span> <span class="s2">"West Bengal"</span><span class="p">,</span> <span class="s2">"Assam"</span><span class="p">],</span>
    <span class="s2">"Electricity_EVs (MU)"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">61.25</span><span class="p">,</span> <span class="mf">9.16</span><span class="p">,</span> <span class="mf">2.96</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.21</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">8.92</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">2.88</span><span class="p">,</span> <span class="mf">5.37</span><span class="p">,</span> <span class="mf">4.84</span><span class="p">,</span> <span class="mf">2.07</span><span class="p">,</span> <span class="mf">2.93</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">],</span>
    <span class="s2">"Electricity_Heavy_Duty (MU)"</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.88</span><span class="p">,</span> <span class="mf">84.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">23.96</span><span class="p">,</span> <span class="mf">1.29</span><span class="p">,</span> <span class="mf">62.81</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mf">1.48</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.67</span><span class="p">,</span> <span class="mf">1.14</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">4.49</span><span class="p">],</span>
    <span class="s2">"Total_Electricity (MU)"</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.05</span><span class="p">,</span> <span class="mf">145.54</span><span class="p">,</span> <span class="mf">9.35</span><span class="p">,</span> <span class="mf">3.69</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">25.17</span><span class="p">,</span> <span class="mf">1.54</span><span class="p">,</span> <span class="mf">71.73</span><span class="p">,</span> <span class="mf">9.63</span><span class="p">,</span> <span class="mf">4.36</span><span class="p">,</span> <span class="mf">5.37</span><span class="p">,</span> <span class="mf">4.84</span><span class="p">,</span> <span class="mf">5.73</span><span class="p">,</span> <span class="mf">4.07</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">1.83</span><span class="p">,</span> <span class="mf">6.48</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Dataset 2: Public Charging Stations</span>
<span class="n">data2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"State"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Andaman &amp; Nicobar"</span><span class="p">,</span> <span class="s2">"Andhra Pradesh"</span><span class="p">,</span> <span class="s2">"Arunachal Pradesh"</span><span class="p">,</span> <span class="s2">"Assam"</span><span class="p">,</span> <span class="s2">"Bihar"</span><span class="p">,</span> <span class="s2">"Chandigarh"</span><span class="p">,</span> 
              <span class="s2">"Chhattisgarh"</span><span class="p">,</span> <span class="s2">"D&amp;D and DNH"</span><span class="p">,</span> <span class="s2">"Delhi"</span><span class="p">,</span> <span class="s2">"Goa"</span><span class="p">,</span> <span class="s2">"Gujarat"</span><span class="p">,</span> <span class="s2">"Haryana"</span><span class="p">,</span> <span class="s2">"Himachal Pradesh"</span><span class="p">,</span> 
              <span class="s2">"Jammu &amp; Kashmir"</span><span class="p">,</span> <span class="s2">"Jharkhand"</span><span class="p">,</span> <span class="s2">"Karnataka"</span><span class="p">,</span> <span class="s2">"Kerala"</span><span class="p">,</span> <span class="s2">"Lakshadweep"</span><span class="p">,</span> <span class="s2">"Madhya Pradesh"</span><span class="p">,</span> 
              <span class="s2">"Maharashtra"</span><span class="p">,</span> <span class="s2">"Manipur"</span><span class="p">,</span> <span class="s2">"Meghalaya"</span><span class="p">,</span> <span class="s2">"Nagaland"</span><span class="p">,</span> <span class="s2">"Odisha"</span><span class="p">,</span> <span class="s2">"Pondicherry"</span><span class="p">,</span> <span class="s2">"Punjab"</span><span class="p">,</span> 
              <span class="s2">"Rajasthan"</span><span class="p">,</span> <span class="s2">"Sikkim"</span><span class="p">,</span> <span class="s2">"Tamil Nadu"</span><span class="p">,</span> <span class="s2">"Telangana"</span><span class="p">,</span> <span class="s2">"Tripura"</span><span class="p">,</span> <span class="s2">"Uttar Pradesh"</span><span class="p">,</span> <span class="s2">"Uttarakhand"</span><span class="p">,</span> 
              <span class="s2">"West Bengal"</span><span class="p">],</span>
    <span class="s2">"Operational_PCS"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1886</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">1041</span><span class="p">,</span> <span class="mi">852</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> 
                         <span class="mi">341</span><span class="p">,</span> <span class="mi">3079</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">643</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">582</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">318</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>

<span class="c1"># Merge datasets based on state/region</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">"Region"</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">"State"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"inner"</span><span class="p">)</span>


<span class="c1"># Visualize electricity consumption vs. charging stations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Operational_PCS"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">"Region"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Electricity Consumption vs. Charging Stations"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Total Electricity Consumption (MU)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Number of Public Charging Stations"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># clusterig analysis</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">,</span> <span class="s2">"Operational_PCS"</span><span class="p">]])</span>

<span class="c1"># Apply KMeans Clustering</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">"Cluster"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Visualize Clusters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">"Cluster"</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="s2">"viridis"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Clustering of States Based on Electricity Consumption and PCS"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Feature 1 (Scaled)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Feature 2 (Scaled)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Regression Analysis</span>
<span class="n">X_reg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">"Operational_PCS"</span><span class="p">]]</span>
<span class="n">y_reg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">]</span>

<span class="n">reg_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">reg_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_reg</span><span class="p">,</span> <span class="n">y_reg</span><span class="p">)</span>

<span class="c1"># Predictions</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_reg</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">"Predicted_Electricity"</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>

<span class="c1"># Regression Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Operational_PCS"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">"color"</span><span class="p">:</span> <span class="s2">"red"</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Regression Analysis: PCS vs. Electricity Consumption"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Operational PCS"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Total Electricity Consumption (MU)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Classification</span>

<span class="n">df</span><span class="p">[</span><span class="s2">"High_EV_Adoption"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="p">[</span><span class="s2">"Total_Electricity (MU)"</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">X_class</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">"Operational_PCS"</span><span class="p">,</span> <span class="s2">"Electricity_EVs (MU)"</span><span class="p">,</span> <span class="s2">"Electricity_Heavy_Duty (MU)"</span><span class="p">]]</span>
<span class="n">y_class</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"High_EV_Adoption"</span><span class="p">]</span>

<span class="n">rf_classifier</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">rf_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_class</span><span class="p">,</span> <span class="n">y_class</span><span class="p">)</span>

<span class="c1"># Feature Importance</span>
<span class="n">importance</span> <span class="o">=</span> <span class="n">rf_classifier</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_class</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">"viridis"</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Feature Importance for EV Adoption Classification"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Importance Score"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Feature"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prepare_predictive_dataset</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Aggregate monthly data and create features</span>
    <span class="n">monthly_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'S.No'</span><span class="p">,</span> <span class="s1">'Year'</span><span class="p">],</span> 
                            <span class="n">var_name</span><span class="o">=</span><span class="s1">'Month'</span><span class="p">,</span> 
                            <span class="n">value_name</span><span class="o">=</span><span class="s1">'Sales'</span><span class="p">)</span>
    <span class="n">monthly_data</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="p">[</span><span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'Total'</span><span class="p">]</span>
    
    <span class="c1"># Create lag features and other predictors</span>
    <span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Year_Numeric'</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Year'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'FY'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Month_Numeric'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Month'</span><span class="p">],</span> 
                                                   <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s1">'Apr'</span><span class="p">,</span><span class="s1">'May'</span><span class="p">,</span><span class="s1">'Jun'</span><span class="p">,</span><span class="s1">'Jul'</span><span class="p">,</span><span class="s1">'Aug'</span><span class="p">,</span><span class="s1">'Sep'</span><span class="p">,</span><span class="s1">'Oct'</span><span class="p">,</span><span class="s1">'Nov'</span><span class="p">,</span><span class="s1">'Dec'</span><span class="p">,</span><span class="s1">'Jan'</span><span class="p">,</span><span class="s1">'Feb'</span><span class="p">,</span><span class="s1">'Mar'</span><span class="p">],</span>
                                                   <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">codes</span>
    
    <span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Lag1'</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">)[</span><span class="s1">'Sales'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">monthly_data</span><span class="p">[</span><span class="s1">'Lag2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'Year'</span><span class="p">)[</span><span class="s1">'Sales'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">monthly_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">monthly_data</span>

<span class="k">def</span> <span class="nf">train_predictive_model</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vehicle_type</span><span class="p">):</span>
    <span class="c1"># Prepare features and target</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">'Year_Numeric'</span><span class="p">,</span> <span class="s1">'Month_Numeric'</span><span class="p">,</span> <span class="s1">'Lag1'</span><span class="p">,</span> <span class="s1">'Lag2'</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'Sales'</span><span class="p">]</span>
    
    <span class="c1"># Split data</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    
    <span class="c1"># Scale features</span>
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># Train Random Forest Regressor</span>
    <span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>
    
    <span class="c1"># Evaluation</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    
    <span class="c1"># Visualization</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y_test</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_test</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="s1">'r--'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">vehicle_type</span><span class="si">}</span><span class="s1"> Sales Prediction'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Actual Sales'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Predicted Sales'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">vehicle_type</span><span class="si">}</span><span class="s2"> Model Performance:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mean Squared Error: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"R-squared: </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">rf_model</span><span class="p">,</span> <span class="n">scaler</span>

<span class="c1"># Prepare and analyze each vehicle type</span>
<span class="n">vehicle_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Two Wheeler'</span><span class="p">:</span> <span class="n">ev2w</span><span class="p">,</span>
    <span class="s1">'Three Wheeler'</span><span class="p">:</span> <span class="n">ev3w</span><span class="p">,</span>
    <span class="s1">'Four Wheeler'</span><span class="p">:</span> <span class="n">ev4w</span>
<span class="p">}</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">vehicle_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="n">prepare_predictive_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_predictive_model</span><span class="p">(</span><span class="n">processed_data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="c1"># Feature Importance Visualization</span>
<span class="k">def</span> <span class="nf">plot_feature_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle_type</span><span class="p">):</span>
    <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Year'</span><span class="p">,</span> <span class="s1">'Month'</span><span class="p">,</span> <span class="s1">'Lag1'</span><span class="p">,</span> <span class="s1">'Lag2'</span><span class="p">]</span>
    <span class="n">importances</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Feature Importances - </span><span class="si">{</span><span class="n">vehicle_type</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">importances</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">importances</span><span class="p">)),</span> <span class="p">[</span><span class="n">feature_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot feature importances</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plot_feature_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span> 
</pre></div>
</div>
</div>
</div>
</div>
